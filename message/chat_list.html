<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Messages</title>
    <link rel="stylesheet" href="chat_list.css">
</head>

<body>
    <div class="user-list" id="recent-users"></div>

    <script>
        const currentUser = localStorage.getItem("username");

        fetch(`http://127.0.0.1:5000/api/recent-users?user=${currentUser}`)
            .then(res => res.json())
            .then(users => {
                const container = document.getElementById("recent-users");
                users.forEach(user => {
                    const div = document.createElement("div");
                    div.className = "user";
                    div.innerHTML = `<img src="http://127.0.0.1:5000/static/uploads/${user.profile_pic}" /><span>${user.username}</span>`;
                    div.onclick = () => {
                        localStorage.setItem("chatWithUser", user.username);
                        localStorage.setItem("chatWithUserPic", user.profile_pic);
                        window.location.href = "/chat/personal_chat.html";
                    };
                    container.appendChild(div);
                });
            });
    </script>
</body>

</html>
